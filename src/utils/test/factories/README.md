# Factories

## Writing a new factory

Create and export a const called `{OBJECT_}FIELDS`. This constant should be an object whose keys are CAPITAL_SNAKE_CASE and whose values are the actual, camelCase names of the fields, e.g. `MY_FIELD: myField`. While this step is not strictly necessary, it will make using your factory much easier, since the keys in question will be available to your IDE.

Create a const called `{object}Factory`, giving it a camelCase name. This const is a function that

- takes params
- returns a `baseFactory`, into which is passed an object containing
  - `fields`: the fields your factory returns
  - any other configuration passable to the `build()` functions [here](https://www.npmjs.com/package/@jackfranklin/test-data-bot), such as `postBuild` or `traits`.
  - the spread params: `...params`.

Export your factory by default.

### Build and post-build

Factories generate data in two phases, the build and the post-build. Most values can be generated in the build phase. Use postBuild when the value of one field should be generated contingent upon the value of another.

### Fields

The fields object defines the structure and values of the object your factory will return. Values of this object can be literals, functions, or another object containing either.

#### Literals

If your field's value is a literal, the factory will always return that value. For example:

`field: 'my value'`

will always set the value of `field` to `'my value'` by default (i.e., unless)

#### Functions

Functions will be evaluated and the field set to their value. This is handy when a hardcoded value shouldn't be set, which is usually the case. You might generate an ID with a function, for example.

#### Objects

Fields can be set to objects and their values will be set recursively.

### Subfactories

If your object has fields that themselves can be generated by a factory, you can pass in a factory function as the value of that field:

`[OBJECT_FIELDS.SUBFACTORY]: (args) => subobjectFactory(args)`

Be sure not to call the function, or its override features will not work.

## Using a factory for mocking test data

A factory can be used simply by calling it, which will return its default configuration.

`const object = objectFactory();`

A number of options are available to pass when a factory is called.

### Overrides

These are values set explicity on your object. The key is available via `BASE_FIELDS`:

````{
  [BASE_FIELDS.OVERRIDES]: {
    [MY_OBJECT_FIELDS.FIELD]: 'my value to override',
  }
}```
````
